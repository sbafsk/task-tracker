<!-- Breadcrumb -->
<nav class="flex mb-5" aria-label="Breadcrumb">
  <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
    <li class="inline-flex items-center">
      <%= link_to projects_list_path, class: "inline-flex items-center text-sm font-medium text-secondary-700 hover:text-primary-600" do %>
        <svg class="w-3 h-3 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
          <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"/>
        </svg>
        Projects
      <% end %>
    </li>
    <li aria-current="page">
      <div class="flex items-center">
        <svg class="rtl:rotate-180 w-3 h-3 text-secondary-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
        </svg>
        <span class="ms-1 text-sm font-medium text-secondary-500 md:ms-2"><%= @project.name %></span>
      </div>
    </li>
  </ol>
</nav>

<!-- Project Header -->
<div class="mb-6 bg-white rounded-lg shadow-card p-6">
  <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
    <div class="flex-1">
      <h1 class="text-3xl font-bold text-secondary-900 font-sans mb-2"><%= @project.name %></h1>
      <% if @project.description.present? %>
        <p class="text-secondary-600"><%= @project.description %></p>
      <% else %>
        <p class="text-secondary-400 italic">No description provided</p>
      <% end %>
    </div>
    <div class="flex gap-2">
      <%= link_to edit_project_path(@project), class: "btn-secondary" do %>
        <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
          <path d="M12.687 14.408a3.01 3.01 0 0 1-1.533.821l-3.566.713a3 3 0 0 1-3.53-3.53l.713-3.566a3.01 3.01 0 0 1 .821-1.533L10.905 2H2.167A2.169 2.169 0 0 0 0 4.167v11.666A2.169 2.169 0 0 0 2.167 18h11.666A2.169 2.169 0 0 0 16 15.833V11.1l-3.313 3.308Zm5.53-9.065.546-.546a2.518 2.518 0 0 0 0-3.56 2.576 2.576 0 0 0-3.559 0l-.547.547 3.56 3.56Z"/>
          <path d="M13.243 3.2 7.359 9.081a.5.5 0 0 0-.136.256L6.51 12.9a.5.5 0 0 0 .59.59l3.566-.713a.5.5 0 0 0 .255-.136L16.8 6.757 13.243 3.2Z"/>
        </svg>
        Edit Project
      <% end %>
      <%= button_to project_path(@project), method: :delete, data: { turbo_confirm: "Confirm you want to delete '#{@project.name}'? This will also delete all tasks in this project." }, class: "btn-danger" do %>
        <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20">
          <path d="M17 4h-4V2a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v2H1a1 1 0 0 0 0 2h1v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6h1a1 1 0 1 0 0-2ZM7 2h4v2H7V2Zm1 14a1 1 0 1 1-2 0V8a1 1 0 0 1 2 0v8Zm4 0a1 1 0 1 1-2 0V8a1 1 0 0 1 2 0v8Z"/>
        </svg>
        Delete Project
      <% end %>
    </div>
  </div>
</div>

<!-- Tasks Section -->
<div class="bg-white rounded-lg shadow-card overflow-hidden">
  <div class="flex items-center justify-between p-6 border-b border-secondary-200">
    <div class="flex items-center gap-2">
      <h2 class="text-xl font-bold text-secondary-900 font-sans">Tasks</h2>
  </div>

    <div class="flex items-center gap-2">
      <% if params[:status].present? || params[:sort].present? %>
        <%= link_to project_path(@project), class: "btn-secondary !p-2", title: "Clear Filters" do %>
          <p class="text-secondary-600">Clear</p>
        <% end %>
      <% end %>
      <%= form_with url: project_path(@project), method: :get, class: "flex items-center gap-2" do |f| %>
        <%= select_tag :status,
            options_for_select([
              ['All Statuses', ''],
              ['Todo', 'todo'],
              ['In Progress', 'in_progress'],
              ['Done', 'done']
            ], params[:status]),
            class: "btn-select",
            onchange: "this.form.requestSubmit()" %>

        <%= select_tag :sort,
            options_for_select([
              ['Sort By', ''],
              ['Priority ↓', 'priority_desc'],
              ['Due Date ↑', 'due_date_asc']
            ], params[:sort]),
            class: "btn-select",
            onchange: "this.form.requestSubmit()" %>
      <% end %>

      <%= link_to new_project_task_path(@project), class: "btn-primary" do %>
        <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        Add Task
      <% end %>
    </div>
  </div>

  <% if @tasks.any? %>
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left rtl:text-right text-secondary-500">
        <thead class="text-xs text-secondary-700 uppercase bg-secondary-50">
          <tr>
            <th scope="col" class="px-6 py-3">Task Title</th>
            <th scope="col" class="px-6 py-3">Status</th>
            <th scope="col" class="px-6 py-3 text-center">Priority</th>
            <th scope="col" class="px-6 py-3">Due Date</th>
            <th scope="col" class="px-6 py-3 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @tasks.each do |task| %>
            <tr class="bg-white border-b hover:bg-secondary-50 transition-colors <%= 'bg-danger-50' if task.overdue? %>">
              <td class="px-6 py-4 font-medium text-secondary-900 whitespace-nowrap">
                <%= task.title %>
                <% if task.overdue? %>
                  <span class="inline-flex items-center bg-danger-100 text-danger-800 text-xs font-medium px-2.5 py-0.5 rounded-full ml-2">
                    <svg class="w-2.5 h-2.5 me-1.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM10 15a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm1-4a1 1 0 0 1-2 0V6a1 1 0 0 1 2 0v5Z"/>
                    </svg>
                    Overdue
                  </span>
                <% end %>
              </td>
              <td class="px-6 py-4">
                <% case task.status %>
                <% when 'todo' %>
                  <span class="inline-flex items-center bg-secondary-100 text-secondary-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                    <span class="w-2 h-2 me-1 bg-secondary-500 rounded-full"></span>
                    Todo
                  </span>
                <% when 'in_progress' %>
                  <span class="inline-flex items-center bg-primary-100 text-primary-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                    <span class="w-2 h-2 me-1 bg-primary-500 rounded-full"></span>
                    In Progress
                  </span>
                <% when 'done' %>
                  <span class="inline-flex items-center bg-success-100 text-success-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                    <svg class="w-2.5 h-2.5 me-1.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/>
                    </svg>
                    Done
                  </span>
                <% end %>
              </td>
              <td class="px-6 py-4 text-center">
                <% priority_colors = {
                  1 => 'bg-danger-100 text-danger-800',
                  2 => 'bg-warning-100 text-warning-800',
                  3 => 'bg-warning-100 text-warning-800',
                  4 => 'bg-secondary-100 text-secondary-800',
                  5 => 'bg-secondary-100 text-secondary-800'
                } %>
                <span class="inline-flex items-center <%= priority_colors[task.priority] %> text-xs font-medium px-2.5 py-0.5 rounded-full">
                  <%= priority_text(task.priority) %>
                </span>
              </td>
              <td class="px-6 py-4">
                <% if task.due_date %>
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-secondary-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                    </svg>
                    <span class="text-secondary-900"><%= task.due_date.strftime("%b %d, %Y") %></span>
                  </div>
                <% else %>
                  <span class="text-secondary-400 italic">No due date</span>
                <% end %>
              </td>
              <td class="px-6 py-4 text-center">
                <button type="button" data-dropdown-toggle="task-dropdown-<%= task.id %>" class="inline-flex items-center p-2 text-sm font-medium text-center text-secondary-900 bg-white rounded-lg hover:bg-secondary-100 focus:ring-4 focus:outline-none focus:ring-secondary-200">
                  <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 3">
                    <path d="M2 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm6.041 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM14 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/>
                  </svg>
                </button>

                <!-- Dropdown menu -->
                <div id="task-dropdown-<%= task.id %>" class="z-10 hidden bg-white divide-y divide-secondary-100 rounded-lg shadow w-44">
                  <ul class="py-2 text-sm text-secondary-700">
                    <li>
                      <%= link_to edit_project_task_path(@project, task), class: "flex items-center px-4 py-2 hover:bg-secondary-100" do %>
                        <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 18">
                          <path d="M12.687 14.408a3.01 3.01 0 0 1-1.533.821l-3.566.713a3 3 0 0 1-3.53-3.53l.713-3.566a3.01 3.01 0 0 1 .821-1.533L10.905 2H2.167A2.169 2.169 0 0 0 0 4.167v11.666A2.169 2.169 0 0 0 2.167 18h11.666A2.169 2.169 0 0 0 16 15.833V11.1l-3.313 3.308Zm5.53-9.065.546-.546a2.518 2.518 0 0 0 0-3.56 2.576 2.576 0 0 0-3.559 0l-.547.547 3.56 3.56Z"/>
                          <path d="M13.243 3.2 7.359 9.081a.5.5 0 0 0-.136.256L6.51 12.9a.5.5 0 0 0 .59.59l3.566-.713a.5.5 0 0 0 .255-.136L16.8 6.757 13.243 3.2Z"/>
                        </svg>
                        Edit
                      <% end %>
                    </li>
                    <li>
                      <%= button_to project_task_path(@project, task), method: :delete, data: { turbo_confirm: "Confirm you want to delete task '#{task.title}'?" }, class: "flex items-center w-full px-4 py-2 hover:bg-danger-50 text-danger-600" do %>
                        <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 20">
                          <path d="M17 4h-4V2a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v2H1a1 1 0 0 0 0 2h1v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6h1a1 1 0 1 0 0-2ZM7 2h4v2H7V2Zm1 14a1 1 0 1 1-2 0V8a1 1 0 0 1 2 0v8Zm4 0a1 1 0 1 1-2 0V8a1 1 0 0 1 2 0v8Z"/>
                        </svg>
                        Delete
                      <% end %>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="text-center py-12">
      <svg class="mx-auto h-12 w-12 text-secondary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
      </svg>
      <h3 class="mt-2 text-sm font-semibold text-secondary-900">
        <% if params[:status].present? || params[:sort].present? %>
          No tasks match filters
        <% else %>
          No tasks yet
        <% end %>
      </h3>
      <p class="mt-1 text-sm text-secondary-500">
        <% if params[:status].present? || params[:sort].present? %>
          Try adjusting your filters or <%= link_to "clear all filters", project_path(@project), class: "text-primary-600 hover:text-primary-500" %>.
        <% else %>
          Get started by adding your first task to this project.
        <% end %>
      </p>
      <% unless params[:status].present? || params[:sort].present? %>
        <div class="mt-6">
          <%= link_to new_project_task_path(@project), class: "btn-primary" do %>
            <svg class="w-4 h-4 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Add Task
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
